import{S as h,r as a,j as e,a as N,c as T}from"../chunks/storage.Cd5s7WAe.js";class I{constructor(s){this.currentSession=null,this.isPlaying=!1,this.isPaused=!1,this.currentWordIndex=0,this.currentRepetition=0,this.sessionWords=[],this.audioQueue=[],this.isProcessingAudio=!1,this.storageManager=s,this.config=this.getDefaultConfig()}getDefaultConfig(){return{repetitionsPerSession:3,wordPause:800,sentencePause:1200,maxWordsPerSession:15,enableBackgroundMusic:!1,speechSpeed:1,exposuresBeforeMastery:5}}async startSession(s){if(this.isPlaying)throw new Error("Session already in progress");if(s&&(this.config={...this.config,...s}),this.sessionWords=await this.getSessionWords(),this.sessionWords.length===0)throw new Error("No words available for Speed Learn session");return this.currentSession={id:`speed-learn-${Date.now()}`,startTime:Date.now(),itemsPlayed:[],repetitionsCompleted:0,completed:!1},this.currentWordIndex=0,this.currentRepetition=0,this.isPlaying=!0,this.isPaused=!1,await this.playCurrentWord(),this.currentSession}async getSessionWords(){const s=await this.storageManager.getAllVocabulary();console.log("Total vocabulary items:",s.length);const t=s.filter(d=>!d.srsData.speedLearnStage||d.srsData.exposureCount===void 0);t.length>0&&(console.warn("Found vocabulary items without Speed Learn fields:",t.length),await this.storageManager.getAllVocabulary());const r=s.filter(d=>d.srsData.speedLearnStage===h.NEW||d.srsData.speedLearnStage===h.PASSIVE_LEARNING);return console.log("New learning words available:",r.length),console.log("Speed Learn is purely for NEW learning - reviews stay in Reviews tab"),r.length===0&&s.length>0?(console.log("No items with Speed Learn stages found, treating all as new"),s.slice(0,this.config.maxWordsPerSession)):r.slice(0,this.config.maxWordsPerSession)}async playCurrentWord(){var t,r;if(!this.isPlaying||this.isPaused||!this.currentSession)return;const s=this.sessionWords[this.currentWordIndex];if(!s){await this.completeSession();return}(t=this.onWordStart)==null||t.call(this,s,this.currentRepetition+1),this.audioQueue=[()=>this.speakText(s.targetLanguageWord,"hi-IN"),()=>this.pause(this.config.wordPause),()=>this.speakText(s.englishTranslation,"en-US"),()=>this.pause(this.config.sentencePause)],await this.processAudioQueue(),await this.updateWordExposure(s),(r=this.onWordComplete)==null||r.call(this,s,this.currentRepetition+1),await this.advanceToNext()}async processAudioQueue(){if(!this.isProcessingAudio){for(this.isProcessingAudio=!0;this.audioQueue.length>0&&this.isPlaying&&!this.isPaused;){const s=this.audioQueue.shift();s&&await s()}this.isProcessingAudio=!1}}speakText(s,t){return new Promise((r,d)=>{if(!this.isPlaying||this.isPaused){r();return}const i=new SpeechSynthesisUtterance(s);i.lang=t,i.rate=this.config.speechSpeed,i.pitch=1,i.volume=1,i.onend=()=>r(),i.onerror=j=>{console.warn("TTS error:",j),r()},speechSynthesis.speak(i)})}pause(s){return new Promise(t=>{if(!this.isPlaying||this.isPaused){t();return}setTimeout(t,s)})}async updateWordExposure(s){const t={...s};t.srsData.exposureCount=(t.srsData.exposureCount||0)+1,t.srsData.lastSpeedLearnSession=Date.now(),t.srsData.exposureCount>=this.config.exposuresBeforeMastery?(t.srsData.speedLearnStage=h.MASTERED,t.srsData.masteredAt=Date.now(),t.srsData.interval=1,t.srsData.nextReviewDate=Date.now()+24*60*60*1e3,t.srsData.repetitions=0,console.log(`Word "${t.targetLanguageWord}" mastered via Speed Learn - now in Reviews tab only`)):t.srsData.speedLearnStage===h.NEW&&(t.srsData.speedLearnStage=h.PASSIVE_LEARNING),await this.storageManager.updateVocabulary(t),this.currentSession&&!this.currentSession.itemsPlayed.includes(s.id)&&this.currentSession.itemsPlayed.push(s.id)}async advanceToNext(){if(!(!this.isPlaying||!this.currentSession)){if(this.currentWordIndex++,this.currentWordIndex>=this.sessionWords.length){if(this.currentRepetition++,this.currentSession.repetitionsCompleted=this.currentRepetition,this.currentRepetition>=this.config.repetitionsPerSession){await this.completeSession();return}this.currentWordIndex=0}setTimeout(()=>this.playCurrentWord(),100)}}async completeSession(){var s;this.currentSession&&(this.currentSession.endTime=Date.now(),this.currentSession.completed=!0,this.currentSession.duration=this.currentSession.endTime-this.currentSession.startTime,this.isPlaying=!1,this.isPaused=!1,await this.saveSession(this.currentSession),(s=this.onSessionComplete)==null||s.call(this,this.currentSession),this.currentSession=null)}pauseSession(){var s;this.isPlaying&&(this.isPaused=!0,speechSynthesis.cancel(),(s=this.onSessionPause)==null||s.call(this))}resumeSession(){var s;!this.isPlaying||!this.isPaused||(this.isPaused=!1,(s=this.onSessionResume)==null||s.call(this),setTimeout(()=>this.playCurrentWord(),100))}async stopSession(){!this.isPlaying||!this.currentSession||(speechSynthesis.cancel(),this.currentSession.endTime=Date.now(),this.currentSession.completed=!1,this.currentSession.duration=this.currentSession.endTime-this.currentSession.startTime,await this.saveSession(this.currentSession),this.isPlaying=!1,this.isPaused=!1,this.currentSession=null)}async saveSession(s){const t=await this.getStoredSessions();t.push(s);const r=t.slice(-50);await chrome.storage.local.set({speedLearnSessions:r})}async getStoredSessions(){return(await chrome.storage.local.get(["speedLearnSessions"])).speedLearnSessions||[]}async getLearningProgress(){const s=await this.storageManager.getAllVocabulary();return{newWords:s.filter(t=>t.srsData.speedLearnStage===h.NEW).length,learningWords:s.filter(t=>t.srsData.speedLearnStage===h.PASSIVE_LEARNING).length,masteredWords:s.filter(t=>t.srsData.speedLearnStage===h.MASTERED).length,totalInTraditionalReviews:s.filter(t=>t.srsData.speedLearnStage===h.MASTERED&&t.srsData.nextReviewDate<=Date.now()).length}}setOnWordStart(s){this.onWordStart=s}setOnWordComplete(s){this.onWordComplete=s}setOnSessionComplete(s){this.onSessionComplete=s}setOnSessionPause(s){this.onSessionPause=s}setOnSessionResume(s){this.onSessionResume=s}getCurrentSession(){return this.currentSession}isSessionActive(){return this.isPlaying}isSessionPaused(){return this.isPaused}getCurrentProgress(){return{wordIndex:this.currentWordIndex,repetition:this.currentRepetition,totalWords:this.sessionWords.length}}}const A=({storageManager:l})=>{const[s]=a.useState(()=>new I(l)),[t,r]=a.useState(!1),[d,i]=a.useState(!1),[j,S]=a.useState(null),[g,p]=a.useState(null),[u,y]=a.useState({wordIndex:0,repetition:0,totalWords:0}),[o,b]=a.useState({repetitionsPerSession:3,wordPause:800,sentencePause:1200,maxWordsPerSession:15,enableBackgroundMusic:!1,speechSpeed:1,exposuresBeforeMastery:5}),[m,P]=a.useState(null);a.useEffect(()=>(s.setOnWordStart((n,C)=>{p(n),y(s.getCurrentProgress())}),s.setOnWordComplete((n,C)=>{y(s.getCurrentProgress())}),s.setOnSessionComplete(n=>{r(!1),i(!1),S(n),p(null),f()}),s.setOnSessionPause(()=>{i(!0)}),s.setOnSessionResume(()=>{i(!1)}),f(),()=>{s.isSessionActive()&&s.stopSession()}),[s]);const f=a.useCallback(async()=>{const n=await s.getLearningProgress();P(n)},[s]),W=async()=>{try{const n=await s.startSession(o);S(n),r(!0),i(!1)}catch(n){console.error("Failed to start Speed Learn session:",n),n instanceof Error&&n.message.includes("No words available")?alert(`No vocabulary items available for Speed Learn. Please:

1. Add vocabulary items in the Options page, OR
2. Click "Migrate Vocabulary" button below if you have existing vocabulary`):alert("Failed to start session. Please check console for details or try migrating your vocabulary.")}},c=()=>{s.pauseSession()},x=()=>{s.resumeSession()},w=async()=>{await s.stopSession(),r(!1),i(!1),p(null),S(null)},v=(n,C)=>{b(D=>({...D,[n]:C}))},R=async()=>{try{await l.constructor.initialize(),alert("Vocabulary migrated successfully! You can now start Speed Learn sessions."),await f()}catch(n){console.error("Migration failed:",n),alert("Migration failed. Please check the console for details.")}};return e.jsxs("div",{className:"speed-learn-container",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"ðŸš€ Speed Learn"}),m&&e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-lg mb-4 border border-green-200",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"ðŸŒ± Speed Learn Progress (New Learning Only)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm mb-3",children:[e.jsxs("div",{className:"bg-blue-100 p-2 rounded text-center",children:[e.jsx("div",{className:"font-bold text-blue-700",children:m.newWords}),e.jsx("div",{className:"text-blue-600",children:"New Words"})]}),e.jsxs("div",{className:"bg-yellow-100 p-2 rounded text-center",children:[e.jsx("div",{className:"font-bold text-yellow-700",children:m.learningWords}),e.jsx("div",{className:"text-yellow-600",children:"Learning"})]}),e.jsxs("div",{className:"bg-green-100 p-2 rounded text-center",children:[e.jsx("div",{className:"font-bold text-green-700",children:m.masteredWords}),e.jsx("div",{className:"text-green-600",children:"Completed"})]}),e.jsxs("div",{className:"bg-purple-100 p-2 rounded text-center",children:[e.jsx("div",{className:"font-bold text-purple-700",children:m.totalInTraditionalReviews}),e.jsx("div",{className:"text-purple-600",children:"In Reviews Tab"})]})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"ðŸ“ Speed Learn = New learning only â€¢ Reviews = Traditional SRS in Reviews tab"})]}),e.jsx("div",{className:"session-controls mb-4",children:t?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex space-x-2",children:[d?e.jsx("button",{onClick:x,className:"flex-1 bg-green-500 text-white py-2 px-4 rounded font-medium hover:bg-green-600",children:"â–¶ï¸ Resume"}):e.jsx("button",{onClick:c,className:"flex-1 bg-yellow-500 text-white py-2 px-4 rounded font-medium hover:bg-yellow-600",children:"â¸ï¸ Pause"}),e.jsx("button",{onClick:w,className:"flex-1 bg-red-500 text-white py-2 px-4 rounded font-medium hover:bg-red-600",children:"â¹ï¸ Stop"})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:W,className:"w-full bg-blue-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-600 transition-colors",children:"ðŸŽµ Start Speed Learn Session"}),e.jsx("button",{onClick:R,className:"w-full bg-gray-500 text-white py-2 px-4 rounded text-sm hover:bg-gray-600",title:"Run this if Speed Learn sessions fail to start",children:"ðŸ”„ Migrate Vocabulary for Speed Learn"})]})}),t&&g&&e.jsx("div",{className:"current-word-display bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg mb-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800 mb-2",children:g.targetLanguageWord}),e.jsx("div",{className:"text-lg text-gray-600 mb-3",children:g.englishTranslation}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Word ",u.wordIndex+1," of ",u.totalWords," â€¢ Repetition ",u.repetition+1," of ",o.repetitionsPerSession]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${(u.wordIndex+u.repetition*u.totalWords)/(o.repetitionsPerSession*u.totalWords)*100}%`}})})]})}),!t&&e.jsxs("div",{className:"config-panel bg-gray-50 p-4 rounded-lg mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-800 mb-3",children:"Session Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["Repetitions per session: ",o.repetitionsPerSession]}),e.jsx("input",{type:"range",min:"2",max:"5",value:o.repetitionsPerSession,onChange:n=>v("repetitionsPerSession",parseInt(n.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["Speech speed: ",o.speechSpeed,"x"]}),e.jsx("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:o.speechSpeed,onChange:n=>v("speechSpeed",parseFloat(n.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["Max words per session: ",o.maxWordsPerSession]}),e.jsx("input",{type:"range",min:"10",max:"25",value:o.maxWordsPerSession,onChange:n=>v("maxWordsPerSession",parseInt(n.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["Word pause: ",(o.wordPause/1e3).toFixed(1),"s"]}),e.jsx("input",{type:"range",min:"500",max:"2000",step:"100",value:o.wordPause,onChange:n=>v("wordPause",parseInt(n.target.value)),className:"w-full"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Pause between Hindi and English"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["Sentence pause: ",(o.sentencePause/1e3).toFixed(1),"s"]}),e.jsx("input",{type:"range",min:"800",max:"3000",step:"100",value:o.sentencePause,onChange:n=>v("sentencePause",parseInt(n.target.value)),className:"w-full"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Pause between different words"})]})]})]})]})},k=()=>{const[l,s]=a.useState(null),[t,r]=a.useState(null),[d,i]=a.useState(!1),[j,S]=a.useState(!0),[g,p]=a.useState("review"),[u]=a.useState(()=>new N);a.useEffect(()=>{y()},[]);const y=async()=>{try{S(!0),await N.initialize();const c=await N.getDueVocabulary(),x=c.length>0?c[0]:null,w=await N.getLearningStats();s(x),r(w)}catch(c){console.error("Failed to load data:",c)}finally{S(!1)}},o=()=>{i(!0)},b=async c=>{if(l)try{const x=Date.now()-(d?1e4:5e3),w=Date.now()-x;await N.processVocabularyReview(l.id,c,w,x),console.log("Review processed successfully for item:",l.id),i(!1),s(null),await y()}catch(x){console.error("Failed to record review:",x)}},m=()=>{if(!l)return;const c=new SpeechSynthesisUtterance(l.targetLanguageWord);c.lang="hi-IN",c.rate=.8,speechSynthesis.speak(c)};if(j)return e.jsx("div",{className:"popup-container loading",children:e.jsx("div",{className:"loading-spinner",children:"Loading..."})});const P=()=>{switch(g){case"speedlearn":return e.jsx(A,{storageManager:u});case"stats":return f();default:return W()}},f=()=>e.jsxs("div",{className:"stats-view",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"ðŸ“Š Learning Stats"}),t&&e.jsxs("div",{className:"stats-grid grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"stat-item bg-blue-50 p-3 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.dueToday}),e.jsx("div",{className:"text-sm text-gray-600",children:"Due Today"})]}),e.jsxs("div",{className:"stat-item bg-green-50 p-3 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.totalItems}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Words"})]}),e.jsxs("div",{className:"stat-item bg-purple-50 p-3 rounded",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[Math.round(t.accuracyRate*100),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Accuracy"})]}),e.jsxs("div",{className:"stat-item bg-orange-50 p-3 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:t.reviewedToday}),e.jsx("div",{className:"text-sm text-gray-600",children:"Reviewed Today"})]})]}),e.jsx("button",{className:"w-full mt-4 bg-gray-500 text-white py-2 rounded hover:bg-gray-600",onClick:()=>chrome.runtime.openOptionsPage(),children:"âš™ï¸ Open Settings"})]}),W=()=>l?e.jsxs("div",{className:"review-content",children:[e.jsxs("div",{className:"review-header mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"ðŸ“ Review Session"}),e.jsx("div",{className:"review-progress text-sm text-gray-600",children:t&&`${t.reviewedToday} reviewed today`})]}),e.jsxs("div",{className:"vocabulary-card bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg mb-4",children:[e.jsx("div",{className:"hindi-text text-3xl font-bold text-center mb-4 text-gray-800",children:l.targetLanguageWord}),e.jsx("div",{className:"text-center mb-4",children:e.jsx("button",{className:"audio-button bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",onClick:m,title:"Play pronunciation",children:"ðŸ”Š Play Audio"})}),d&&e.jsx("div",{className:"english-translation text-xl text-center text-gray-700 font-medium",children:l.englishTranslation})]}),e.jsx("div",{className:"action-buttons",children:d?e.jsxs("div",{className:"quality-buttons grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"quality-btn bg-red-500 text-white py-2 rounded hover:bg-red-600",onClick:()=>b(1),children:"Again"}),e.jsx("button",{className:"quality-btn bg-orange-500 text-white py-2 rounded hover:bg-orange-600",onClick:()=>b(2),children:"Hard"}),e.jsx("button",{className:"quality-btn bg-green-500 text-white py-2 rounded hover:bg-green-600",onClick:()=>b(3),children:"Good"}),e.jsx("button",{className:"quality-btn bg-blue-500 text-white py-2 rounded hover:bg-blue-600",onClick:()=>b(4),children:"Easy"})]}):e.jsx("button",{className:"w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600",onClick:o,children:"Show Answer"})})]}):e.jsxs("div",{className:"no-reviews-view",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"ðŸ“ Reviews"}),e.jsxs("div",{className:"no-reviews-message text-center py-8",children:[e.jsx("p",{className:"text-2xl mb-2",children:"ðŸŽ‰"}),e.jsx("p",{className:"text-gray-800 font-medium",children:"No reviews due right now!"}),e.jsx("p",{className:"text-gray-600",children:"Great job staying on top of your learning!"})]}),e.jsx("button",{className:"w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600",onClick:()=>chrome.runtime.openOptionsPage(),children:"âš™ï¸ Open Settings"})]});return e.jsxs("div",{className:"popup-container w-80 bg-white",children:[e.jsxs("div",{className:"tab-navigation flex border-b border-gray-200 mb-4",children:[e.jsx("button",{className:`flex-1 py-2 px-4 text-sm font-medium ${g==="review"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>p("review"),children:"ðŸ“ Reviews"}),e.jsx("button",{className:`flex-1 py-2 px-4 text-sm font-medium ${g==="speedlearn"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>p("speedlearn"),children:"ðŸš€ Speed Learn"}),e.jsx("button",{className:`flex-1 py-2 px-4 text-sm font-medium ${g==="stats"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>p("stats"),children:"ðŸ“Š Stats"})]}),e.jsx("div",{className:"tab-content",children:P()})]})},L=document.getElementById("root");L?T(L).render(e.jsx(k,{})):console.error("Failed to find root element");
