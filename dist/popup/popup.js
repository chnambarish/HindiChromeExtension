import{S as u,r as i,j as e,a as j,c as T}from"../chunks/storage.Blbi0nzw.js";class E{constructor(s){this.currentSession=null,this.isPlaying=!1,this.isPaused=!1,this.currentWordIndex=0,this.currentRepetition=0,this.sessionWords=[],this.audioQueue=[],this.isProcessingAudio=!1,this.storageManager=s,this.config=this.getDefaultConfig()}getDefaultConfig(){return{repetitionsPerSession:3,wordPause:800,sentencePause:1200,maxWordsPerSession:15,enableBackgroundMusic:!1,speechSpeed:1,exposuresBeforeMastery:5}}async startSession(s){if(this.isPlaying)throw new Error("Session already in progress");if(s&&(this.config={...this.config,...s}),this.sessionWords=await this.getSessionWords(),this.sessionWords.length===0)throw new Error("No words available for Speed Learn session");return this.currentSession={id:`speed-learn-${Date.now()}`,startTime:Date.now(),itemsPlayed:[],repetitionsCompleted:0,completed:!1},this.currentWordIndex=0,this.currentRepetition=0,this.isPlaying=!0,this.isPaused=!1,await this.playCurrentWord(),this.currentSession}async getSessionWords(){const s=await this.storageManager.getAllVocabulary();console.log("Total vocabulary items:",s.length);const t=s.filter(d=>!d.srsData.speedLearnStage||d.srsData.exposureCount===void 0);t.length>0&&(console.warn("Found vocabulary items without Speed Learn fields:",t.length),await this.storageManager.getAllVocabulary());const r=s.filter(d=>d.srsData.speedLearnStage===u.NEW||d.srsData.speedLearnStage===u.PASSIVE_LEARNING),h=s.filter(d=>d.srsData.speedLearnStage===u.LONG_TERM_REVIEW&&d.srsData.nextReviewDate<=Date.now());return console.log("New words available:",r.length),console.log("Review words available:",h.length),r.length===0&&h.length===0&&s.length>0?(console.log("No items with Speed Learn stages found, treating all as new"),s.slice(0,this.config.maxWordsPerSession)):[...r.slice(0,Math.min(10,this.config.maxWordsPerSession-5)),...h.slice(0,5)].slice(0,this.config.maxWordsPerSession)}async playCurrentWord(){var t,r;if(!this.isPlaying||this.isPaused||!this.currentSession)return;const s=this.sessionWords[this.currentWordIndex];if(!s){await this.completeSession();return}(t=this.onWordStart)==null||t.call(this,s,this.currentRepetition+1),this.audioQueue=[()=>this.speakText(s.targetLanguageWord,"hi-IN"),()=>this.pause(this.config.wordPause),()=>this.speakText(s.englishTranslation,"en-US"),()=>this.pause(this.config.sentencePause)],await this.processAudioQueue(),await this.updateWordExposure(s),(r=this.onWordComplete)==null||r.call(this,s,this.currentRepetition+1),await this.advanceToNext()}async processAudioQueue(){if(!this.isProcessingAudio){for(this.isProcessingAudio=!0;this.audioQueue.length>0&&this.isPlaying&&!this.isPaused;){const s=this.audioQueue.shift();s&&await s()}this.isProcessingAudio=!1}}speakText(s,t){return new Promise((r,h)=>{if(!this.isPlaying||this.isPaused){r();return}const a=new SpeechSynthesisUtterance(s);a.lang=t,a.rate=this.config.speechSpeed,a.pitch=1,a.volume=1,a.onend=()=>r(),a.onerror=d=>{console.warn("TTS error:",d),r()},speechSynthesis.speak(a)})}pause(s){return new Promise(t=>{if(!this.isPlaying||this.isPaused){t();return}setTimeout(t,s)})}async updateWordExposure(s){const t={...s};t.srsData.exposureCount=(t.srsData.exposureCount||0)+1,t.srsData.lastSpeedLearnSession=Date.now(),t.srsData.exposureCount>=this.config.exposuresBeforeMastery?(t.srsData.speedLearnStage=u.MASTERED,t.srsData.masteredAt=Date.now(),t.srsData.interval=3,t.srsData.nextReviewDate=Date.now()+3*24*60*60*1e3,t.srsData.speedLearnStage=u.LONG_TERM_REVIEW):t.srsData.speedLearnStage===u.NEW&&(t.srsData.speedLearnStage=u.PASSIVE_LEARNING),await this.storageManager.updateVocabulary(t),this.currentSession&&!this.currentSession.itemsPlayed.includes(s.id)&&this.currentSession.itemsPlayed.push(s.id)}async advanceToNext(){if(!(!this.isPlaying||!this.currentSession)){if(this.currentWordIndex++,this.currentWordIndex>=this.sessionWords.length){if(this.currentRepetition++,this.currentSession.repetitionsCompleted=this.currentRepetition,this.currentRepetition>=this.config.repetitionsPerSession){await this.completeSession();return}this.currentWordIndex=0}setTimeout(()=>this.playCurrentWord(),100)}}async completeSession(){var s;this.currentSession&&(this.currentSession.endTime=Date.now(),this.currentSession.completed=!0,this.currentSession.duration=this.currentSession.endTime-this.currentSession.startTime,this.isPlaying=!1,this.isPaused=!1,await this.saveSession(this.currentSession),(s=this.onSessionComplete)==null||s.call(this,this.currentSession),this.currentSession=null)}pauseSession(){var s;this.isPlaying&&(this.isPaused=!0,speechSynthesis.cancel(),(s=this.onSessionPause)==null||s.call(this))}resumeSession(){var s;!this.isPlaying||!this.isPaused||(this.isPaused=!1,(s=this.onSessionResume)==null||s.call(this),setTimeout(()=>this.playCurrentWord(),100))}async stopSession(){!this.isPlaying||!this.currentSession||(speechSynthesis.cancel(),this.currentSession.endTime=Date.now(),this.currentSession.completed=!1,this.currentSession.duration=this.currentSession.endTime-this.currentSession.startTime,await this.saveSession(this.currentSession),this.isPlaying=!1,this.isPaused=!1,this.currentSession=null)}async saveSession(s){const t=await this.getStoredSessions();t.push(s);const r=t.slice(-50);await chrome.storage.local.set({speedLearnSessions:r})}async getStoredSessions(){return(await chrome.storage.local.get(["speedLearnSessions"])).speedLearnSessions||[]}async getLearningProgress(){const s=await this.storageManager.getAllVocabulary();return{newWords:s.filter(t=>t.srsData.speedLearnStage===u.NEW).length,learningWords:s.filter(t=>t.srsData.speedLearnStage===u.PASSIVE_LEARNING).length,masteredWords:s.filter(t=>t.srsData.speedLearnStage===u.MASTERED).length,reviewWords:s.filter(t=>t.srsData.speedLearnStage===u.LONG_TERM_REVIEW).length}}setOnWordStart(s){this.onWordStart=s}setOnWordComplete(s){this.onWordComplete=s}setOnSessionComplete(s){this.onSessionComplete=s}setOnSessionPause(s){this.onSessionPause=s}setOnSessionResume(s){this.onSessionResume=s}getCurrentSession(){return this.currentSession}isSessionActive(){return this.isPlaying}isSessionPaused(){return this.isPaused}getCurrentProgress(){return{wordIndex:this.currentWordIndex,repetition:this.currentRepetition,totalWords:this.sessionWords.length}}}const I=({storageManager:l})=>{const[s]=i.useState(()=>new E(l)),[t,r]=i.useState(!1),[h,a]=i.useState(!1),[d,b]=i.useState(null),[x,p]=i.useState(null),[g,f]=i.useState({wordIndex:0,repetition:0,totalWords:0}),[o,y]=i.useState({repetitionsPerSession:3,wordPause:800,sentencePause:1200,maxWordsPerSession:15,enableBackgroundMusic:!1,speechSpeed:1,exposuresBeforeMastery:5}),[S,P]=i.useState(null);i.useEffect(()=>(s.setOnWordStart((n,C)=>{p(n),f(s.getCurrentProgress())}),s.setOnWordComplete((n,C)=>{f(s.getCurrentProgress())}),s.setOnSessionComplete(n=>{r(!1),a(!1),b(n),p(null),w()}),s.setOnSessionPause(()=>{a(!0)}),s.setOnSessionResume(()=>{a(!1)}),w(),()=>{s.isSessionActive()&&s.stopSession()}),[s]);const w=i.useCallback(async()=>{const n=await s.getLearningProgress();P(n)},[s]),W=async()=>{try{const n=await s.startSession(o);b(n),r(!0),a(!1)}catch(n){console.error("Failed to start Speed Learn session:",n),n instanceof Error&&n.message.includes("No words available")?alert(`No vocabulary items available for Speed Learn. Please:

1. Add vocabulary items in the Options page, OR
2. Click "Migrate Vocabulary" button below if you have existing vocabulary`):alert("Failed to start session. Please check console for details or try migrating your vocabulary.")}},c=()=>{s.pauseSession()},m=()=>{s.resumeSession()},v=async()=>{await s.stopSession(),r(!1),a(!1),p(null),b(null)},N=(n,C)=>{y(D=>({...D,[n]:C}))},R=async()=>{try{await l.constructor.initialize(),alert("Vocabulary migrated successfully! You can now start Speed Learn sessions."),await w()}catch(n){console.error("Migration failed:",n),alert("Migration failed. Please check the console for details.")}};return e.jsxs("div",{className:"speed-learn-container",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"ðŸš€ Speed Learn"}),S&&e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-lg mb-4 border border-green-200",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"ðŸŒ± Learning Progress"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-blue-100 p-2 rounded text-center",children:[e.jsx("div",{className:"font-bold text-blue-700",children:S.newWords}),e.jsx("div",{className:"text-blue-600",children:"New Words"})]}),e.jsxs("div",{className:"bg-yellow-100 p-2 rounded text-center",children:[e.jsx("div",{className:"font-bold text-yellow-700",children:S.learningWords}),e.jsx("div",{className:"text-yellow-600",children:"Learning"})]}),e.jsxs("div",{className:"bg-green-100 p-2 rounded text-center",children:[e.jsx("div",{className:"font-bold text-green-700",children:S.masteredWords}),e.jsx("div",{className:"text-green-600",children:"Mastered"})]}),e.jsxs("div",{className:"bg-purple-100 p-2 rounded text-center",children:[e.jsx("div",{className:"font-bold text-purple-700",children:S.reviewWords}),e.jsx("div",{className:"text-purple-600",children:"Reviews"})]})]})]}),e.jsx("div",{className:"session-controls mb-4",children:t?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex space-x-2",children:[h?e.jsx("button",{onClick:m,className:"flex-1 bg-green-500 text-white py-2 px-4 rounded font-medium hover:bg-green-600",children:"â–¶ï¸ Resume"}):e.jsx("button",{onClick:c,className:"flex-1 bg-yellow-500 text-white py-2 px-4 rounded font-medium hover:bg-yellow-600",children:"â¸ï¸ Pause"}),e.jsx("button",{onClick:v,className:"flex-1 bg-red-500 text-white py-2 px-4 rounded font-medium hover:bg-red-600",children:"â¹ï¸ Stop"})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:W,className:"w-full bg-blue-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-600 transition-colors",children:"ðŸŽµ Start Speed Learn Session"}),e.jsx("button",{onClick:R,className:"w-full bg-gray-500 text-white py-2 px-4 rounded text-sm hover:bg-gray-600",title:"Run this if Speed Learn sessions fail to start",children:"ðŸ”„ Migrate Vocabulary for Speed Learn"})]})}),t&&x&&e.jsx("div",{className:"current-word-display bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg mb-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800 mb-2",children:x.targetLanguageWord}),e.jsx("div",{className:"text-lg text-gray-600 mb-3",children:x.englishTranslation}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Word ",g.wordIndex+1," of ",g.totalWords," â€¢ Repetition ",g.repetition+1," of ",o.repetitionsPerSession]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${(g.wordIndex+g.repetition*g.totalWords)/(o.repetitionsPerSession*g.totalWords)*100}%`}})})]})}),!t&&e.jsxs("div",{className:"config-panel bg-gray-50 p-4 rounded-lg mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-800 mb-3",children:"Session Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["Repetitions per session: ",o.repetitionsPerSession]}),e.jsx("input",{type:"range",min:"2",max:"5",value:o.repetitionsPerSession,onChange:n=>N("repetitionsPerSession",parseInt(n.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["Speech speed: ",o.speechSpeed,"x"]}),e.jsx("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:o.speechSpeed,onChange:n=>N("speechSpeed",parseFloat(n.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["Max words per session: ",o.maxWordsPerSession]}),e.jsx("input",{type:"range",min:"10",max:"25",value:o.maxWordsPerSession,onChange:n=>N("maxWordsPerSession",parseInt(n.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["Word pause: ",(o.wordPause/1e3).toFixed(1),"s"]}),e.jsx("input",{type:"range",min:"500",max:"2000",step:"100",value:o.wordPause,onChange:n=>N("wordPause",parseInt(n.target.value)),className:"w-full"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Pause between Hindi and English"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["Sentence pause: ",(o.sentencePause/1e3).toFixed(1),"s"]}),e.jsx("input",{type:"range",min:"800",max:"3000",step:"100",value:o.sentencePause,onChange:n=>N("sentencePause",parseInt(n.target.value)),className:"w-full"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Pause between different words"})]})]})]})]})},A=()=>{const[l,s]=i.useState(null),[t,r]=i.useState(null),[h,a]=i.useState(!1),[d,b]=i.useState(!0),[x,p]=i.useState("review"),[g]=i.useState(()=>new j);i.useEffect(()=>{f()},[]);const f=async()=>{try{b(!0),await j.initialize();const c=await j.getDueVocabulary(),m=c.length>0?c[0]:null,v=await j.getLearningStats();s(m),r(v)}catch(c){console.error("Failed to load data:",c)}finally{b(!1)}},o=()=>{a(!0)},y=async c=>{if(l)try{const m=Date.now()-(h?1e4:5e3),v=Date.now()-m;await j.processVocabularyReview(l.id,c,v,m),console.log("Review processed successfully for item:",l.id),a(!1),s(null),await f()}catch(m){console.error("Failed to record review:",m)}},S=()=>{if(!l)return;const c=new SpeechSynthesisUtterance(l.targetLanguageWord);c.lang="hi-IN",c.rate=.8,speechSynthesis.speak(c)};if(d)return e.jsx("div",{className:"popup-container loading",children:e.jsx("div",{className:"loading-spinner",children:"Loading..."})});const P=()=>{switch(x){case"speedlearn":return e.jsx(I,{storageManager:g});case"stats":return w();default:return W()}},w=()=>e.jsxs("div",{className:"stats-view",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"ðŸ“Š Learning Stats"}),t&&e.jsxs("div",{className:"stats-grid grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"stat-item bg-blue-50 p-3 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.dueToday}),e.jsx("div",{className:"text-sm text-gray-600",children:"Due Today"})]}),e.jsxs("div",{className:"stat-item bg-green-50 p-3 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.totalItems}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Words"})]}),e.jsxs("div",{className:"stat-item bg-purple-50 p-3 rounded",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[Math.round(t.accuracyRate*100),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Accuracy"})]}),e.jsxs("div",{className:"stat-item bg-orange-50 p-3 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:t.reviewedToday}),e.jsx("div",{className:"text-sm text-gray-600",children:"Reviewed Today"})]})]}),e.jsx("button",{className:"w-full mt-4 bg-gray-500 text-white py-2 rounded hover:bg-gray-600",onClick:()=>chrome.runtime.openOptionsPage(),children:"âš™ï¸ Open Settings"})]}),W=()=>l?e.jsxs("div",{className:"review-content",children:[e.jsxs("div",{className:"review-header mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"ðŸ“ Review Session"}),e.jsx("div",{className:"review-progress text-sm text-gray-600",children:t&&`${t.reviewedToday} reviewed today`})]}),e.jsxs("div",{className:"vocabulary-card bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg mb-4",children:[e.jsx("div",{className:"hindi-text text-3xl font-bold text-center mb-4 text-gray-800",children:l.targetLanguageWord}),e.jsx("div",{className:"text-center mb-4",children:e.jsx("button",{className:"audio-button bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",onClick:S,title:"Play pronunciation",children:"ðŸ”Š Play Audio"})}),h&&e.jsx("div",{className:"english-translation text-xl text-center text-gray-700 font-medium",children:l.englishTranslation})]}),e.jsx("div",{className:"action-buttons",children:h?e.jsxs("div",{className:"quality-buttons grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"quality-btn bg-red-500 text-white py-2 rounded hover:bg-red-600",onClick:()=>y(1),children:"Again"}),e.jsx("button",{className:"quality-btn bg-orange-500 text-white py-2 rounded hover:bg-orange-600",onClick:()=>y(2),children:"Hard"}),e.jsx("button",{className:"quality-btn bg-green-500 text-white py-2 rounded hover:bg-green-600",onClick:()=>y(3),children:"Good"}),e.jsx("button",{className:"quality-btn bg-blue-500 text-white py-2 rounded hover:bg-blue-600",onClick:()=>y(4),children:"Easy"})]}):e.jsx("button",{className:"w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600",onClick:o,children:"Show Answer"})})]}):e.jsxs("div",{className:"no-reviews-view",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"ðŸ“ Reviews"}),e.jsxs("div",{className:"no-reviews-message text-center py-8",children:[e.jsx("p",{className:"text-2xl mb-2",children:"ðŸŽ‰"}),e.jsx("p",{className:"text-gray-800 font-medium",children:"No reviews due right now!"}),e.jsx("p",{className:"text-gray-600",children:"Great job staying on top of your learning!"})]}),e.jsx("button",{className:"w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600",onClick:()=>chrome.runtime.openOptionsPage(),children:"âš™ï¸ Open Settings"})]});return e.jsxs("div",{className:"popup-container w-80 bg-white",children:[e.jsxs("div",{className:"tab-navigation flex border-b border-gray-200 mb-4",children:[e.jsx("button",{className:`flex-1 py-2 px-4 text-sm font-medium ${x==="review"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>p("review"),children:"ðŸ“ Reviews"}),e.jsx("button",{className:`flex-1 py-2 px-4 text-sm font-medium ${x==="speedlearn"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>p("speedlearn"),children:"ðŸš€ Speed Learn"}),e.jsx("button",{className:`flex-1 py-2 px-4 text-sm font-medium ${x==="stats"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>p("stats"),children:"ðŸ“Š Stats"})]}),e.jsx("div",{className:"tab-content",children:P()})]})},L=document.getElementById("root");L?T(L).render(e.jsx(A,{})):console.error("Failed to find root element");
