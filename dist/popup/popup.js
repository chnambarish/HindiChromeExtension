import{S,r as n,j as e,a as N,c as M}from"../chunks/storage.BXWST12r.js";class z{constructor(s){this.currentSession=null,this.isPlaying=!1,this.isPaused=!1,this.currentWordIndex=0,this.currentRepetition=0,this.sessionWords=[],this.audioQueue=[],this.isProcessingAudio=!1,this.storageManager=s,this.config=this.getDefaultConfig()}getDefaultConfig(){return{repetitionsPerSession:3,wordPause:1500,sentencePause:3e3,maxWordsPerSession:15,enableBackgroundMusic:!1,speechSpeed:1,exposuresBeforeQuiz:5}}async startSession(s){if(this.isPlaying)throw new Error("Session already in progress");if(s&&(this.config={...this.config,...s}),this.sessionWords=await this.getSessionWords(),this.sessionWords.length===0)throw new Error("No words available for Speed Learn session");return this.currentSession={id:`speed-learn-${Date.now()}`,startTime:Date.now(),itemsPlayed:[],repetitionsCompleted:0,completed:!1},this.currentWordIndex=0,this.currentRepetition=0,this.isPlaying=!0,this.isPaused=!1,await this.playCurrentWord(),this.currentSession}async getSessionWords(){const s=await this.storageManager.getAllVocabulary();console.log("Total vocabulary items:",s.length);const t=s.filter(l=>!l.srsData.speedLearnStage||l.srsData.exposureCount===void 0);t.length>0&&(console.warn("Found vocabulary items without Speed Learn fields:",t.length),await this.storageManager.getAllVocabulary());const a=s.filter(l=>l.srsData.speedLearnStage===S.NEW||l.srsData.speedLearnStage===S.PASSIVE_LEARNING),c=s.filter(l=>l.srsData.speedLearnStage===S.LONG_TERM_REVIEW&&l.srsData.nextReviewDate<=Date.now());return console.log("New words available:",a.length),console.log("Review words available:",c.length),a.length===0&&c.length===0&&s.length>0?(console.log("No items with Speed Learn stages found, treating all as new"),s.slice(0,this.config.maxWordsPerSession)):[...a.slice(0,Math.min(10,this.config.maxWordsPerSession-5)),...c.slice(0,5)].slice(0,this.config.maxWordsPerSession)}async playCurrentWord(){var t,a;if(!this.isPlaying||this.isPaused||!this.currentSession)return;const s=this.sessionWords[this.currentWordIndex];if(!s){await this.completeSession();return}(t=this.onWordStart)==null||t.call(this,s,this.currentRepetition+1),this.audioQueue=[()=>this.speakText(s.targetLanguageWord,"hi-IN"),()=>this.pause(this.config.wordPause),()=>this.speakText(s.englishTranslation,"en-US"),()=>this.pause(this.config.sentencePause)],await this.processAudioQueue(),await this.updateWordExposure(s),(a=this.onWordComplete)==null||a.call(this,s,this.currentRepetition+1),await this.advanceToNext()}async processAudioQueue(){if(!this.isProcessingAudio){for(this.isProcessingAudio=!0;this.audioQueue.length>0&&this.isPlaying&&!this.isPaused;){const s=this.audioQueue.shift();s&&await s()}this.isProcessingAudio=!1}}speakText(s,t){return new Promise((a,c)=>{if(!this.isPlaying||this.isPaused){a();return}const i=new SpeechSynthesisUtterance(s);i.lang=t,i.rate=this.config.speechSpeed,i.pitch=1,i.volume=1,i.onend=()=>a(),i.onerror=l=>{console.warn("TTS error:",l),a()},speechSynthesis.speak(i)})}pause(s){return new Promise(t=>{if(!this.isPlaying||this.isPaused){t();return}setTimeout(t,s)})}async updateWordExposure(s){const t={...s};t.srsData.exposureCount=(t.srsData.exposureCount||0)+1,t.srsData.lastSpeedLearnSession=Date.now(),t.srsData.exposureCount>=this.config.exposuresBeforeQuiz?t.srsData.speedLearnStage=S.READY_FOR_QUIZ:t.srsData.speedLearnStage===S.NEW&&(t.srsData.speedLearnStage=S.PASSIVE_LEARNING),await this.storageManager.updateVocabulary(t),this.currentSession&&!this.currentSession.itemsPlayed.includes(s.id)&&this.currentSession.itemsPlayed.push(s.id)}async advanceToNext(){if(!(!this.isPlaying||!this.currentSession)){if(this.currentWordIndex++,this.currentWordIndex>=this.sessionWords.length){if(this.currentRepetition++,this.currentSession.repetitionsCompleted=this.currentRepetition,this.currentRepetition>=this.config.repetitionsPerSession){await this.completeSession();return}this.currentWordIndex=0}setTimeout(()=>this.playCurrentWord(),100)}}async completeSession(){var s;this.currentSession&&(this.currentSession.endTime=Date.now(),this.currentSession.completed=!0,this.currentSession.duration=this.currentSession.endTime-this.currentSession.startTime,this.isPlaying=!1,this.isPaused=!1,await this.saveSession(this.currentSession),(s=this.onSessionComplete)==null||s.call(this,this.currentSession),this.currentSession=null)}pauseSession(){var s;this.isPlaying&&(this.isPaused=!0,speechSynthesis.cancel(),(s=this.onSessionPause)==null||s.call(this))}resumeSession(){var s;!this.isPlaying||!this.isPaused||(this.isPaused=!1,(s=this.onSessionResume)==null||s.call(this),setTimeout(()=>this.playCurrentWord(),100))}async stopSession(){!this.isPlaying||!this.currentSession||(speechSynthesis.cancel(),this.currentSession.endTime=Date.now(),this.currentSession.completed=!1,this.currentSession.duration=this.currentSession.endTime-this.currentSession.startTime,await this.saveSession(this.currentSession),this.isPlaying=!1,this.isPaused=!1,this.currentSession=null)}async saveSession(s){const t=await this.getStoredSessions();t.push(s);const a=t.slice(-50);await chrome.storage.local.set({speedLearnSessions:a})}async getStoredSessions(){return(await chrome.storage.local.get(["speedLearnSessions"])).speedLearnSessions||[]}async getWordsReadyForQuiz(){return(await this.storageManager.getAllVocabulary()).filter(t=>t.srsData.speedLearnStage===S.READY_FOR_QUIZ)}async markWordAsMastered(s){const t=await this.storageManager.getVocabulary(s);t&&(t.srsData.speedLearnStage=S.MASTERED,t.srsData.masteredAt=Date.now(),await this.storageManager.updateVocabulary(t))}setOnWordStart(s){this.onWordStart=s}setOnWordComplete(s){this.onWordComplete=s}setOnSessionComplete(s){this.onSessionComplete=s}setOnSessionPause(s){this.onSessionPause=s}setOnSessionResume(s){this.onSessionResume=s}getCurrentSession(){return this.currentSession}isSessionActive(){return this.isPlaying}isSessionPaused(){return this.isPaused}getCurrentProgress(){return{wordIndex:this.currentWordIndex,repetition:this.currentRepetition,totalWords:this.sessionWords.length}}}const O=({storageManager:o})=>{const[s]=n.useState(()=>new z(o)),[t,a]=n.useState(!1),[c,i]=n.useState(!1),[l,x]=n.useState(null),[m,p]=n.useState(null),[u,h]=n.useState({wordIndex:0,repetition:0,totalWords:0}),[g,f]=n.useState({repetitionsPerSession:3,wordPause:1500,sentencePause:3e3,maxWordsPerSession:15,enableBackgroundMusic:!1,speechSpeed:1,exposuresBeforeQuiz:5}),[w,j]=n.useState([]),[P,v]=n.useState(!1),[d,b]=n.useState(null);n.useEffect(()=>(s.setOnWordStart((r,W)=>{p(r),h(s.getCurrentProgress())}),s.setOnWordComplete((r,W)=>{h(s.getCurrentProgress())}),s.setOnSessionComplete(r=>{a(!1),i(!1),x(r),p(null),y()}),s.setOnSessionPause(()=>{i(!0)}),s.setOnSessionResume(()=>{i(!1)}),y(),()=>{s.isSessionActive()&&s.stopSession()}),[s]);const y=n.useCallback(async()=>{const r=await s.getWordsReadyForQuiz();j(r)},[s]),k=async()=>{try{const r=await s.startSession(g);x(r),a(!0),i(!1)}catch(r){console.error("Failed to start Speed Learn session:",r),r instanceof Error&&r.message.includes("No words available")?alert(`No vocabulary items available for Speed Learn. Please:

1. Add vocabulary items in the Options page, OR
2. Click "Migrate Vocabulary" button below if you have existing vocabulary`):alert("Failed to start session. Please check console for details or try migrating your vocabulary.")}},L=()=>{s.pauseSession()},A=()=>{s.resumeSession()},T=async()=>{await s.stopSession(),a(!1),i(!1),p(null),x(null)},C=(r,W)=>{f(Q=>({...Q,[r]:W}))},D=r=>{b(r),v(!0)},I=async r=>{d&&r&&(await s.markWordAsMastered(d.id),await y()),v(!1),b(null)},E=async()=>{try{await o.constructor.initialize(),alert("Vocabulary migrated successfully! You can now start Speed Learn sessions.")}catch(r){console.error("Migration failed:",r),alert("Migration failed. Please check the console for details.")}};return e.jsxs("div",{className:"speed-learn-container",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"üöÄ Speed Learn"}),w.length>0&&e.jsx("div",{className:"bg-orange-100 border-l-4 border-orange-500 p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-orange-800",children:"Quiz Time! üéØ"}),e.jsxs("p",{className:"text-sm text-orange-700",children:[w.length," words ready for quiz"]})]}),e.jsx("button",{onClick:()=>D(w[0]),className:"bg-orange-500 text-white px-3 py-1 rounded text-sm hover:bg-orange-600",children:"Start Quiz"})]})}),e.jsx("div",{className:"session-controls mb-4",children:t?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex space-x-2",children:[c?e.jsx("button",{onClick:A,className:"flex-1 bg-green-500 text-white py-2 px-4 rounded font-medium hover:bg-green-600",children:"‚ñ∂Ô∏è Resume"}):e.jsx("button",{onClick:L,className:"flex-1 bg-yellow-500 text-white py-2 px-4 rounded font-medium hover:bg-yellow-600",children:"‚è∏Ô∏è Pause"}),e.jsx("button",{onClick:T,className:"flex-1 bg-red-500 text-white py-2 px-4 rounded font-medium hover:bg-red-600",children:"‚èπÔ∏è Stop"})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:k,className:"w-full bg-blue-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-600 transition-colors",children:"üéµ Start Speed Learn Session"}),e.jsx("button",{onClick:E,className:"w-full bg-gray-500 text-white py-2 px-4 rounded text-sm hover:bg-gray-600",title:"Run this if Speed Learn sessions fail to start",children:"üîÑ Migrate Vocabulary for Speed Learn"})]})}),t&&m&&e.jsx("div",{className:"current-word-display bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg mb-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800 mb-2",children:m.targetLanguageWord}),e.jsx("div",{className:"text-lg text-gray-600 mb-3",children:m.englishTranslation}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Word ",u.wordIndex+1," of ",u.totalWords," ‚Ä¢ Repetition ",u.repetition+1," of ",g.repetitionsPerSession]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${(u.wordIndex+u.repetition*u.totalWords)/(g.repetitionsPerSession*u.totalWords)*100}%`}})})]})}),!t&&e.jsxs("div",{className:"config-panel bg-gray-50 p-4 rounded-lg mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-800 mb-3",children:"Session Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["Repetitions per session: ",g.repetitionsPerSession]}),e.jsx("input",{type:"range",min:"2",max:"5",value:g.repetitionsPerSession,onChange:r=>C("repetitionsPerSession",parseInt(r.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["Speech speed: ",g.speechSpeed,"x"]}),e.jsx("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:g.speechSpeed,onChange:r=>C("speechSpeed",parseFloat(r.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["Max words per session: ",g.maxWordsPerSession]}),e.jsx("input",{type:"range",min:"10",max:"25",value:g.maxWordsPerSession,onChange:r=>C("maxWordsPerSession",parseInt(r.target.value)),className:"w-full"})]})]})]}),P&&d&&e.jsx(F,{word:d,onComplete:I,onClose:()=>v(!1)})]})},F=({word:o,onComplete:s,onClose:t})=>{const[a,c]=n.useState(""),[i,l]=n.useState(!1),[x,m]=n.useState(!1),p=()=>{const h=a.toLowerCase().trim()===o.englishTranslation.toLowerCase().trim();m(h),l(!0)},u=()=>{s(x)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"üß† Quick Quiz"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"What does this mean in English?"}),e.jsx("div",{className:"text-2xl font-bold text-center py-4 bg-gray-50 rounded",children:o.targetLanguageWord})]}),i?e.jsxs("div",{children:[e.jsxs("div",{className:`text-center py-4 rounded mb-4 ${x?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[x?"‚úÖ Correct!":"‚ùå Not quite",e.jsxs("div",{className:"text-sm mt-2",children:["Correct answer: ",e.jsx("strong",{children:o.englishTranslation})]})]}),e.jsx("button",{onClick:u,className:"w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600",children:"Continue"})]}):e.jsxs("div",{children:[e.jsx("input",{type:"text",value:a,onChange:h=>c(h.target.value),placeholder:"Type your answer...",className:"w-full p-2 border border-gray-300 rounded mb-4",onKeyPress:h=>h.key==="Enter"&&p(),autoFocus:!0}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:p,className:"flex-1 bg-blue-500 text-white py-2 rounded hover:bg-blue-600",children:"Check Answer"}),e.jsx("button",{onClick:t,className:"px-4 bg-gray-300 text-gray-700 py-2 rounded hover:bg-gray-400",children:"Skip"})]})]})]})})},V=()=>{const[o,s]=n.useState(null),[t,a]=n.useState(null),[c,i]=n.useState(!1),[l,x]=n.useState(!0),[m,p]=n.useState("review"),[u]=n.useState(()=>new N);n.useEffect(()=>{h()},[]);const h=async()=>{try{x(!0),await N.initialize();const d=await N.getDueVocabulary(),b=d.length>0?d[0]:null,y=await N.getLearningStats();s(b),a(y)}catch(d){console.error("Failed to load data:",d)}finally{x(!1)}},g=()=>{i(!0)},f=async d=>{if(o)try{const b=Date.now()-(c?1e4:5e3),y=Date.now()-b;await N.processVocabularyReview(o.id,d,y,b),console.log("Review processed successfully for item:",o.id),i(!1),s(null),await h()}catch(b){console.error("Failed to record review:",b)}},w=()=>{if(!o)return;const d=new SpeechSynthesisUtterance(o.targetLanguageWord);d.lang="hi-IN",d.rate=.8,speechSynthesis.speak(d)};if(l)return e.jsx("div",{className:"popup-container loading",children:e.jsx("div",{className:"loading-spinner",children:"Loading..."})});const j=()=>{switch(m){case"speedlearn":return e.jsx(O,{storageManager:u});case"stats":return P();default:return v()}},P=()=>e.jsxs("div",{className:"stats-view",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"üìä Learning Stats"}),t&&e.jsxs("div",{className:"stats-grid grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"stat-item bg-blue-50 p-3 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.dueToday}),e.jsx("div",{className:"text-sm text-gray-600",children:"Due Today"})]}),e.jsxs("div",{className:"stat-item bg-green-50 p-3 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.totalItems}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Words"})]}),e.jsxs("div",{className:"stat-item bg-purple-50 p-3 rounded",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[Math.round(t.accuracyRate*100),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Accuracy"})]}),e.jsxs("div",{className:"stat-item bg-orange-50 p-3 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:t.reviewedToday}),e.jsx("div",{className:"text-sm text-gray-600",children:"Reviewed Today"})]})]}),e.jsx("button",{className:"w-full mt-4 bg-gray-500 text-white py-2 rounded hover:bg-gray-600",onClick:()=>chrome.runtime.openOptionsPage(),children:"‚öôÔ∏è Open Settings"})]}),v=()=>o?e.jsxs("div",{className:"review-content",children:[e.jsxs("div",{className:"review-header mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"üìè Review Session"}),e.jsx("div",{className:"review-progress text-sm text-gray-600",children:t&&`${t.reviewedToday} reviewed today`})]}),e.jsxs("div",{className:"vocabulary-card bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg mb-4",children:[e.jsx("div",{className:"hindi-text text-3xl font-bold text-center mb-4 text-gray-800",children:o.targetLanguageWord}),e.jsx("div",{className:"text-center mb-4",children:e.jsx("button",{className:"audio-button bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",onClick:w,title:"Play pronunciation",children:"üîä Play Audio"})}),c&&e.jsx("div",{className:"english-translation text-xl text-center text-gray-700 font-medium",children:o.englishTranslation})]}),e.jsx("div",{className:"action-buttons",children:c?e.jsxs("div",{className:"quality-buttons grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"quality-btn bg-red-500 text-white py-2 rounded hover:bg-red-600",onClick:()=>f(1),children:"Again"}),e.jsx("button",{className:"quality-btn bg-orange-500 text-white py-2 rounded hover:bg-orange-600",onClick:()=>f(2),children:"Hard"}),e.jsx("button",{className:"quality-btn bg-green-500 text-white py-2 rounded hover:bg-green-600",onClick:()=>f(3),children:"Good"}),e.jsx("button",{className:"quality-btn bg-blue-500 text-white py-2 rounded hover:bg-blue-600",onClick:()=>f(4),children:"Easy"})]}):e.jsx("button",{className:"w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600",onClick:g,children:"Show Answer"})})]}):e.jsxs("div",{className:"no-reviews-view",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"üìè Reviews"}),e.jsxs("div",{className:"no-reviews-message text-center py-8",children:[e.jsx("p",{className:"text-2xl mb-2",children:"üéâ"}),e.jsx("p",{className:"text-gray-800 font-medium",children:"No reviews due right now!"}),e.jsx("p",{className:"text-gray-600",children:"Great job staying on top of your learning!"})]}),e.jsx("button",{className:"w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600",onClick:()=>chrome.runtime.openOptionsPage(),children:"‚öôÔ∏è Open Settings"})]});return e.jsxs("div",{className:"popup-container w-80 bg-white",children:[e.jsxs("div",{className:"tab-navigation flex border-b border-gray-200 mb-4",children:[e.jsx("button",{className:`flex-1 py-2 px-4 text-sm font-medium ${m==="review"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>p("review"),children:"üìè Reviews"}),e.jsx("button",{className:`flex-1 py-2 px-4 text-sm font-medium ${m==="speedlearn"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>p("speedlearn"),children:"üöÄ Speed Learn"}),e.jsx("button",{className:`flex-1 py-2 px-4 text-sm font-medium ${m==="stats"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>p("stats"),children:"üìä Stats"})]}),e.jsx("div",{className:"tab-content",children:j()})]})},R=document.getElementById("root");R?M(R).render(e.jsx(V,{})):console.error("Failed to find root element");
